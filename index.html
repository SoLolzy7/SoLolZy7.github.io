<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NeoVision Hand Tracker</title>
<style>
:root {
  --bg: #0c1022;
  --panel1: linear-gradient(145deg, #1c1f34, #111425);
  --panel2: linear-gradient(160deg, #131b2f, #0e1427);
  --accent: #7c3aed;
  --glow: #00e7ff;
  --text: #e4ebfa;
  --subtext: #94a3b8;
}
html, body {
  margin: 0; padding: 0;
  background: radial-gradient(circle at top left, #111729 0%, #070b15 80%);
  font-family: 'Inter', sans-serif;
  color: var(--text);
  overflow-x: hidden;
}
.wrap {
  max-width: 1200px;
  margin: 30px auto;
  padding: 20px;
  border-radius: 16px;
  background: rgba(255,255,255,0.02);
  box-shadow: 0 8px 40px rgba(0,0,0,0.6);
}
h1 {
  font-size: 28px;
  font-weight: 800;
  color: #9fafff;
  text-shadow: 0 0 15px rgba(124,58,237,0.4);
  margin-bottom: 8px;
}
.subtitle {
  color: var(--subtext);
  font-size: 14px;
  margin-bottom: 16px;
}
.grid {
  display: grid;
  grid-template-columns: 1fr 420px;
  gap: 18px;
  align-items: start;
}
.camera-wrap {
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 25px rgba(0, 231, 255, 0.25);
  background: black;
}
video {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 12px;
  transform-origin: center;
}
.right-col {
  display: flex;
  flex-direction: column;
  gap: 18px;
}

/* panel styles */
.panel {
  border-radius: 14px;
  padding: 16px;
  background: var(--panel1);
  box-shadow: inset 0 0 20px rgba(255,255,255,0.03),
              0 0 25px rgba(0,0,0,0.7);
  transition: background 0.4s;
}
.panel.gesture {
  background: var(--panel2);
  border: 1px solid rgba(255,255,255,0.08);
}
.label {
  color: var(--subtext);
  font-size: 13px;
  margin-bottom: 4px;
}
.big {
  font-size: 42px;
  font-weight: 800;
  color: var(--glow);
  text-shadow: 0 0 15px var(--glow);
}
.gestureName {
  font-size: 22px;
  font-weight: 700;
  color: #9fafff;
  text-shadow: 0 0 12px rgba(124,58,237,0.5);
}
.controls {
  margin-top: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
button {
  background: linear-gradient(90deg, var(--accent), #a855f7);
  border: none;
  color: white;
  font-weight: 600;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  transition: all 0.25s;
}
button:hover {
  filter: brightness(1.15);
}
.pill {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,0.05);
  font-size: 13px;
  border: 1px solid rgba(255,255,255,0.07);
  margin-top: 4px;
}
.footerNote {
  font-size: 12px;
  color: var(--subtext);
  margin-top: 6px;
}

/* skeleton panel */
.skeleton {
  position: relative;
  background: linear-gradient(180deg,#0d1328,#0b0f1f);
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: inset 0 0 10px rgba(255,255,255,0.03), 0 0 20px rgba(0,231,255,0.15);
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 320px;
}
#skeletonCanvas {
  width: 100%;
  height: 100%;
}

/* animation */
.pop {
  animation: popAnim 350ms ease-out;
}
@keyframes popAnim {
  0% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}

/* responsive */
@media (max-width: 980px) {
  .grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div class="wrap">
  <h1>NeoVision Hand Tracker</h1>
  <div class="subtitle">AI-powered hand recognition â€” gesture detection, counter, and 3D skeleton rendering âš¡</div>

  <div class="grid">
    <div class="camera-wrap">
      <video id="video" autoplay muted playsinline></video>
    </div>

    <div class="right-col">
      <div class="panel gesture">
        <div class="label">Current Gesture</div>
        <div id="gestureName" class="gestureName">ðŸ”´ No hand</div>
        <div class="label" style="margin-top:10px;">Raise count (5-finger)</div>
        <div id="raiseCount" class="big">0</div>
        <div class="controls">
          <label><input type="checkbox" id="mirror" checked> Mirror webcam</label>
          <button id="toggleCamBtn">Stop Camera</button>
          <div class="pill" id="statusPill">Camera: On</div>
          <div class="footerNote">Running locally or HTTPS required for webcam access.</div>
        </div>
      </div>

      <div class="panel skeleton">
        <canvas id="skeletonCanvas"></canvas>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById('video');
const skeletonCanvas = document.getElementById('skeletonCanvas');
const sctx = skeletonCanvas.getContext('2d');
const mirrorCheckbox = document.getElementById('mirror');
const toggleCamBtn = document.getElementById('toggleCamBtn');
const statusPill = document.getElementById('statusPill');
const gestureNameEl = document.getElementById('gestureName');
const raiseCountEl = document.getElementById('raiseCount');

let camera=null, cameraRunning=false, lastGesture=null, raiseCount=0;

// resize canvas
function fitCanvas() {
  skeletonCanvas.width = skeletonCanvas.clientWidth;
  skeletonCanvas.height = skeletonCanvas.clientHeight;
}
window.addEventListener('resize',fitCanvas);
fitCanvas();

// finger logic
function countFingers(landmarks, handedness){
  const tips=[4,8,12,16,20], pips=[2,6,10,14,18];
  let c=0;
  if(handedness==='Right'){
    if(landmarks[tips[0]].x<landmarks[pips[0]].x)c++;
  } else {
    if(landmarks[tips[0]].x>landmarks[pips[0]].x)c++;
  }
  for(let i=1;i<5;i++){
    if(landmarks[tips[i]].y<landmarks[pips[i]].y)c++;
  }
  return c;
}
function gestureFromCount(n){
  if(n===0)return 'âœŠ Fist';
  if(n===1)return 'â˜ One';
  if(n===2)return 'âœŒ Peace';
  if(n===5)return 'ðŸ– Open Hand';
  return `${n} fingers`;
}
function drawSkeleton(landmarks,handedness){
  sctx.clearRect(0,0,skeletonCanvas.width,skeletonCanvas.height);
  const w=skeletonCanvas.width,h=skeletonCanvas.height;
  const mirror=mirrorCheckbox.checked;
  const pts=landmarks.map(p=>({x:(mirror?(1-p.x):p.x)*w,y:p.y*h}));
  const connections=[
    [0,1],[1,2],[2,3],[3,4],
    [0,5],[5,6],[6,7],[7,8],
    [5,9],[9,10],[10,11],[11,12],
    [9,13],[13,14],[14,15],[15,16],
    [13,17],[17,18],[18,19],[19,20],
    [0,17]
  ];
  const grad=sctx.createLinearGradient(0,0,w,h);
  grad.addColorStop(0,'#7c3aed');
  grad.addColorStop(1,'#00e7ff');
  sctx.strokeStyle=grad;
  sctx.lineWidth=3;
  sctx.beginPath();
  for(const c of connections){
    const a=pts[c[0]],b=pts[c[1]];
    sctx.moveTo(a.x,a.y);
    sctx.lineTo(b.x,b.y);
  }
  sctx.stroke();
  sctx.fillStyle='#ffffff';
  pts.forEach((p,i)=>{
    sctx.beginPath();
    sctx.arc(p.x,p.y,[4,5,6].includes(i%8)?4:3,0,Math.PI*2);
    sctx.fill();
  });
}

// mediapipe setup
const hands=new Hands({locateFile:(f)=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:0.7,minTrackingConfidence:0.6});
hands.onResults(onResults);

function onResults(results){
  const hasHand=results.multiHandLandmarks&&results.multiHandLandmarks.length>0;
  if(!hasHand){sctx.clearRect(0,0,skeletonCanvas.width,skeletonCanvas.height);updateUI(null);return;}
  const landmarks=results.multiHandLandmarks[0];
  const handedness=results.multiHandedness&&results.multiHandedness[0]?results.multiHandedness[0].label:'Right';
  drawSkeleton(landmarks,handedness);
  const n=countFingers(landmarks,handedness);
  const gesture=gestureFromCount(n);
  if(gesture!==lastGesture){
    gestureNameEl.classList.add('pop');
    setTimeout(()=>gestureNameEl.classList.remove('pop'),350);
    if(n===5&&lastGesture!=='ðŸ– Open Hand'){
      raiseCount++;
      raiseCountEl.textContent=raiseCount;
      raiseCountEl.classList.add('pop');
      setTimeout(()=>raiseCountEl.classList.remove('pop'),350);
    }
    lastGesture=gesture;
  }
  updateUI(gesture);
}
function updateUI(gesture){
  if(!gesture){gestureNameEl.textContent='ðŸ”´ No hand';return;}
  gestureNameEl.textContent=gesture;
}

// camera
async function startCam(){
  if(cameraRunning)return;
  const stream=await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject=stream;
  await video.play();
  video.style.transform=mirrorCheckbox.checked?'scaleX(-1)':'scaleX(1)';
  camera=new Camera(video,{onFrame:async()=>await hands.send({image:video})});
  camera.start();
  cameraRunning=true;
  toggleCamBtn.textContent='Stop Camera';
  statusPill.textContent='Camera: On';
}
function stopCam(){
  if(!cameraRunning)return;
  camera.stop();
  if(video.srcObject){video.srcObject.getTracks().forEach(t=>t.stop());}
  cameraRunning=false;
  toggleCamBtn.textContent='Start Camera';
  statusPill.textContent='Camera: Off';
  sctx.clearRect(0,0,skeletonCanvas.width,skeletonCanvas.height);
  updateUI(null);
}
toggleCamBtn.addEventListener('click',()=>cameraRunning?stopCam():startCam());
mirrorCheckbox.addEventListener('change',()=>{video.style.transform=mirrorCheckbox.checked?'scaleX(-1)':'scaleX(1)';});
startCam();
</script>
</body>
</html>